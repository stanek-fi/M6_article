\documentclass[tikz,margin=5pt]{standalone}
\usetikzlibrary{decorations.pathreplacing}
\usepackage{pgfmath}

\begin{document}

\def\ii{-8}
\def\msii{-8}
\def\msjj{8}
% \def\msjj{5.4}
% \def\msjj{4.8}
\def\colflow{black!70}
\def\colbg{black!10}
\def\colbase{green!70!black!50}
% \def\colbasea{green!70!black!10}
% \def\colbasea{green!70!black!40}
\def\colbasea{rgb:red,120;green,168;blue,00}
\def\colbaseb{rgb:red,00;green,224;blue,50}
% \def\colbaseb{rgb:red,00;green,168;blue,90}
\def\colms{red!70!black!50}
\def\colmt{blue!70!black!50}
\def\colbasetext{green!70!black!100}
\def\colmstext{red!70!black!100}
\def\colmttext{blue!70!black!100}
% * library(stringr)
% * str_c(sprintf("%.1f", round(rnorm(6,0,1),1)),collapse=", ")
\def\xxxxa{{"1.3","-0.1","-0.3", "-0.6", "1.2", "-0.3", "-0.3", "-0.9"}}%
\def\xxxxb{{"-0.4", "1.0", "-0.9", "-1.1", "0.8", "-1.1", "-0.4", "-0.3"}}%
\def\xxxxc{{"-2.1", "0.4", "-1.7","2.3", "1.0", "-0.9", "0.6", "0.5"}}%
\def\xxxxd{{"0.0","-0.9", "2.6","0.1", "-1.1", "0.8", "0.3", "0.9"}}%
\def\xxxxe{{"1.9","-0.1", "0.3","0.5", "0.4", "-0.5", "0.3", "-0.2"}}%
\def\yyyye{{"0.3","0.2", "0.0","0.2", "0.3"}}%
\def\qqqqa{{"1", "0", "0", "0", "0", "0", "0", "0", "0"}}%
\def\qqqqe{{"0", "0", "0", "0", "0", "0", "0", "0", "1"}}%
\def\mmmm{{"-0.9","2.1","0.8", "0.3", "-0.4", "-0.0", "-0.7", "-1.5", "-0.0", "-0.1", "-0.3", "-0.4", "-0.8", "-0.9", "0.9"}}%
\def\msms{{"-0.4", "2.3"}}%
\begin{tikzpicture}[
    every text node part/.style={align=center},
    nodes={minimum height = 10mm, minimum width = 10mm, outer sep=0mm, anchor=center, draw},
    data/.style args={#1}{draw, fill=black!00, label={[text=black]center: \normalsize #1}, minimum height = 5mm, minimum width = 9mm, outer sep=0pt},
    databeta/.style args={#1}{draw, fill=black!00, label={[text=\colbase]center: \normalsize #1}, minimum height = 5mm, minimum width = 9mm, outer sep=0pt},
    databetaa/.style args={#1}{draw, fill=black!00, label={[text=\colbasea]center: \normalsize #1}, minimum height = 5mm, minimum width = 9mm, outer sep=0pt},
    databetab/.style args={#1}{draw, fill=black!00, label={[text=\colbaseb]center: \normalsize #1}, minimum height = 5mm, minimum width = 9mm, outer sep=0pt},
    blank/.style={circle,draw=blue!00,minimum size=0.5cm},
    % neuron/.style={circle, draw=blue!50!black, fill=white!100, minimum size=0.5cm},
    % neuron/.style={circle, draw=black, fill=white, minimum size=0.5cm},
    neuron/.style={circle, draw=black, fill=black, minimum size = 0.001cm, inner sep=0pt},
    neuron_base/.style={circle, draw=\colbase, fill=white!100, minimum size=0.5cm},
    neuron_basea/.style={circle, draw=\colbasea, fill=white!100, minimum size=0.5cm},
    neuron_baseb/.style={circle, draw=\colbaseb, fill=white!100, minimum size=0.5cm},
    neuron_ms/.style={circle, draw=\colms, fill=white!100, minimum size=0.5cm},
    neuron_mt/.style={circle, draw=\colmt, fill=white!100, minimum size=0.5cm},
    dots/.style={circle, draw=blue!50!black, minimum size=0.5cm},
    y=0.6cm,
    font=\sffamily
]
% -- Base model  ----------------------------------------------------------------------------------------------------------------------------------
% * data
\draw[rounded corners, draw = black!30, fill=\colbg] (-1-0.4-2+0.4, \ii+0.8) rectangle (6+0.4-0.4, \ii-9-0.8) {};
% \foreach \cj in {1,2,3,4} {
%     \node[data=\pgfmathparse{\xxxxa[\cj-1]}\pgfmathresult] at (-1+\cj-0.5-2,1-1) {};
% }
% \path (-1+3-1,1-1) -- (-1+4-1,1-1) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
% \foreach \cj in {5,6,7,8} {
%     \node[data=\pgfmathparse{\xxxxa[\cj-1]}\pgfmathresult] at (-1+\cj+0.5-2,1-1) {};
% }
% \foreach \cj in {1,2,3,4} {
%     \node[data=\pgfmathparse{\xxxxb[\cj-1]}\pgfmathresult] at (-1+\cj-0.5-2,1-2) {};
% }
% \path (-1+3-1,1-2) -- (-1+4-1,1-2) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
% \foreach \cj in {5,6,7,8} {
%     \node[data=\pgfmathparse{\xxxxb[\cj-1]}\pgfmathresult] at (-1+\cj+0.5-2,1-2) {};
% }
\foreach \cj in {1,2,3,4} {
    \node[data=\pgfmathparse{\xxxxc[\cj-1]}\pgfmathresult] at (-1+\cj-0.5-2,1-3) {};
}
\path (-1+3-1,1-3) -- (-1+4-1,1-3) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
\foreach \cj in {5,6,7,8} {
    \node[data=\pgfmathparse{\xxxxc[\cj-1]}\pgfmathresult] at (-1+\cj+0.5-2,1-3) {};
}
\foreach \cj in {1,2,3,4} {
    \node[data=\pgfmathparse{\xxxxd[\cj-1]}\pgfmathresult] at (-1+\cj-0.5-2,1-4) {};
}
\path (-1+3-1,1-4) -- (-1+4-1,1-4) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
\foreach \cj in {5,6,7,8} {
    \node[data=\pgfmathparse{\xxxxd[\cj-1]}\pgfmathresult] at (-1+\cj+0.5-2,1-4) {};
}
\foreach \cj in {1,2,3,4} {
    \path (-1+\cj-.5-2,-4) -- (-1+\cj-.5-2,-5) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
}
\foreach \cj in {5,6,7,8} {
    \path (-1+\cj+.5-2,-4) -- (-1+\cj+.5-2,-5) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
}
\foreach \cj in {1,2,3,4} {
    \node[data=\pgfmathparse{\xxxxe[\cj-1]}\pgfmathresult] (data\cj) at (-1+\cj-0.5-2,1-7) {};
}
\path (-1+3-1,1-7) -- (-1+4-1,1-7) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
\foreach \cj in {5,6,7,8} {
    \node[data=\pgfmathparse{\xxxxe[\cj-1]}\pgfmathresult] (data\cj) at (-1+\cj+0.5-2,1-7) {};
}


% *  neurons
% \foreach \cj in {1,2,3,4,5,6} {
%     \node[neuron] (a\cj) at (-1+\cj,\ii) {};
% }
\foreach \cj in {1,2,3,4} {
    \node[neuron] (a\cj) at (-1+\cj-2.5,\ii) {};
}
% \path (-1+\cj-2.5,1-4) -- (-1+\cj-2.5,1-4) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
\path (-1+3-1,1-9) -- (-1+4-1,1-9) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
\foreach \cj in {5,6,7,8} {
    \node[neuron] (a\cj) at (-1+\cj-1.5,\ii) {};
}
\path (-1+3-1,1-12) -- (-1+4-1,1-12) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
\foreach \cj in {1,2,3,4} {
    \node[neuron_basea] (b\cj) at (-1+\cj-2.5,\ii-3) {};
}
\foreach \cj in {5,6,7,8} {
    \node[neuron_basea] (b\cj) at (-1+\cj-1.5,\ii-3) {};
}
\foreach \cj in {1,2,3,4,5,6,7,8} {
    \node[neuron_basea] (bb\cj) at (-2+\cj-1,\ii-6) {};
}
\foreach \cj in {1,2,3,4,5} {
    \node[neuron_baseb] (c\cj) at (-1+\cj-0.5,\ii-9) {};
}
% \foreach \cj in {1,2,3,4} {
    % \node[neuron] (d\cj) at (\cj,\ii-12) {};
% }
% \foreach \cj in {1,2} {
    % \node[neuron] (e\cj) at (1+\cj,\ii-15) {};
% }
% \node[neuron] (f1) at (2.5,\ii - 18) {};
% \path (3.5, \ii-18-0.8+0.8+18) --  (6+0.4, \ii-18-0.8+0.8) node[midway,draw=none] {base model: \\ $\hat{y} = f(x; \mathbin{\textcolor{\colbasetext}{\beta}}) $};
% \path (3.5, \ii) --  (6.4, \ii-18) node[midway,draw=none] {base model: \\ $\hat{y} = f(x; \mathbin{\textcolor{\colbasetext}{\beta}}) $};
\path (3.5, \ii-8) --  (6.4, \ii-10) node[midway,draw=none] {base model: \\ $\hat{y} = f(x; \mathbin{\textcolor{\colbasetext}{\beta}}) $};

% *  arrows
\foreach \cnto in {1,2,3,4,5,6,7,8} {
    \draw[-latex, draw=\colflow] (data\cnto)--(a\cnto);
}
\foreach \cnto in {1,2,3,4,5,6,7,8} {
    \foreach \cntt in {1,2,3,4,5,6,7,8} {
        \draw[-latex, draw=\colbasea] (a\cnto)--(b\cntt);
    }
}
\foreach \cnto in {1,2,3,4,5,6,7,8} {
    \foreach \cntt in {1,2,3,4,5,6,7,8} {
        \draw[-latex, draw=\colbasea] (b\cnto)--(bb\cntt);
    }
}
\foreach \cnto in {1,2,3,4,5,6,7,8} {
    \foreach \cntt in {1,2,3,4,5} {
        \draw[-latex, draw=\colbaseb] (bb\cnto)--(c\cntt);
    }
}

% *  neurons duplicated
\foreach \cj in {1,2,3,4} {
    \node[neuron_basea] (tempb\cj) at (-1+\cj-2.5,\ii-3) {};
}
\foreach \cj in {5,6,7,8} {
    \node[neuron_basea] (tempb\cj) at (-1+\cj-1.5,\ii-3) {};
}
\foreach \cj in {1,2,3,4,5,6,7,8} {
    \node[neuron_basea] (tempbb\cj) at (-2+\cj-1,\ii-6) {};
}
\foreach \cj in {1,2,3,4,5} {
    \node[neuron_baseb] (tempc\cj) at (-1+\cj-0.5,\ii-9) {};
}

% * yhat
\foreach \cj in {1,2,3,4,5} {
    \node[data=\pgfmathparse{\yyyye[\cj-1]}\pgfmathresult] (yhat\cj) at (-1+\cj+0.5-1,\ii-11) {};
}
\foreach \cj in {1,2,3,4,5} {
    \draw[-latex, draw=\colflow] (c\cj)--(yhat\cj);
}

% -- Meta-Mesa Module  ----------------------------------------------------------------------------------------------------------------------------------
% * data
% \foreach \ci in {1,2,3,4} {
\foreach \ci in {3,4} {
    \foreach \cj in {1,2,3,4} {
        \node[data=\pgfmathparse{\qqqqa[\cj-1]}\pgfmathresult] at (\msjj+\cj,1-\ci) {};
    }
    % \path (-1+3+10.5,1-\ci) -- (-1+4+10.5,1-\ci) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
    \path (\msjj-8-1+3+10.5,1-\ci) -- (\msjj-8-1+4+10.5,1-\ci) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
    \foreach \cj in {6,7,8,9} {
        \node[data=\pgfmathparse{\qqqqa[\cj-1]}\pgfmathresult] at (\msjj+\cj,1-\ci) {};
    }
}
\foreach \cj in {1,2,3,4} {
    \path (\msjj+\cj,-4) -- (\msjj+\cj,-5) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
}
\foreach \cj in {6,7,8,9} {
    \path (\msjj+\cj,-4) -- (\msjj+\cj,-5) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
}
\foreach \ci in {7} {
    \foreach \cj in {1,2,3,4} {
        \node[data=\pgfmathparse{\qqqqe[\cj-1]}\pgfmathresult] (msdata\cj) at (\msjj+\cj,1-\ci) {};
    }
    \path (\msjj-8-1+3+10.5,1-\ci) -- (\msjj-8-1+4+10.5,1-\ci) node [black, font=\large, midway, sloped, draw=black!0] {$\dots$};
    \foreach \cj in {6,7,8,9} {
        \node[data=\pgfmathparse{\qqqqe[\cj-1]}\pgfmathresult] (msdata\cj) at (\msjj+\cj,1-\ci) {};
    }
}

% *  neurons
\draw[rounded corners, draw = black!30, fill = \colbg] (\msjj-1-0.4+2.2+0.6-1, \msii+0.8) rectangle (\msjj+11+0.4-2.2-0.6+1, \msii-3-0.8) {};
\draw[rounded corners, draw = black!30, fill = \colbg] (\msjj-1-0.4+2.2+0.6-2, \msii-7+0.8) rectangle (\msjj+11+0.4-2.2-0.6+2, \msii-13-0.8+3) {};
% \draw[rounded corners, draw = black!30, fill = \colbg] (\msjj-1-0.4, \msii+0.8) rectangle (\msjj+11+0.4, \msii-3+0.2) {};
% \draw[rounded corners, draw = black!30, fill = \colbg] (\msjj-1-0.4, \msii-3-0.2) rectangle (\msjj+11+0.4, \msii-9-0.8) {};
\foreach \cj in {1,2,3,4,6,7,8,9} {
    \node[neuron] (msa\cj) at (\msjj+\cj,\msii) {};
}
\path (\msjj-8-1+3+10.5,1-9) -- (\msjj-8-1+4+10.5,1-9) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
\foreach \cj in {1} {
    \node[neuron_ms] (msb\cj) at (4+\msjj+\cj,\msii-3) {};
}
\path (\msjj+8-0.4+0.8, \msii-3) --  (\msjj+11+0.4-0.3-1-3.5-0.4+0.8, \msii-3) node[midway,draw=none] {mesa module: \\ $\theta = \left(\mathbin{\textcolor{\colmstext}{ \theta^{(1)},...,\theta^{(M)} }}\right)q$};
\foreach \cj in {1} {
    \node[data=\pgfmathparse{\msms[\cj-1]}\pgfmathresult] (betams\cj) at (4+\msjj+\cj,\msii-5) {};
}
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](3.5+\msjj+2-0.5,\msii-5+0.4) -- (3.5+\msjj+2-0.5,\msii-5-0.4) node[midway,xshift=3em,draw=none](beta){$\theta$};
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](8-3+0.5,\msii+2+0.4) -- (8-3+0.5,\msii+2-0.4) node[midway,xshift=3em,draw=none](beta){$x$};
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](8-5.5+1,\msii-20+0.4+9) -- (8-5.5+1,\msii-20-0.4+9) node[midway,xshift=3em,draw=none](beta){$\hat{y}$};
% \draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](\msjj+9-1,\msii+2+0.4) -- (\msjj+9-1,\msii+2-0.4) node[midway,xshift=3em,draw=none](beta){$q$};
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](\msjj+9,\msii+2+0.4) -- (\msjj+9,\msii+2-0.4) node[midway,xshift=3em,draw=none](beta){$q$};
\foreach \cj in {1} {
    \node[neuron] (mtb\cj) at (4+\msjj+\cj,\msii-7) {};
}
% \foreach \cj in {1,2,3} {
%     \node[neuron] (msc\cj) at (3+\msjj+\cj,\msii-10) {};
% }
\foreach \cj in {2,3,4,5,6,8,9,10,11,12} {
    \node[neuron_mt] (msd\cj) at (-2+\msjj+\cj,\msii-10) {};
}
\path (-2+\msjj+6,\msii-12) -- (-2+\msjj+8,\msii-12) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
\path (\msjj+8-0.5+2.2, \msii-6-0.2-0.8) --  (\msjj+11+0.4-0.3-1-3-0.5+2.2, \msii-6-0.2-0.8) node[midway,draw=none] {meta module: \\ $\mathbin{\textcolor{\colbasetext}{\beta}} = g(\theta;\mathbin{\textcolor{\colmttext}{\omega}})$};

% *  arrows
\foreach \cnto in {1,2,3,4,6,7,8,9} {
    \draw[-latex, draw=\colflow] (msdata\cnto)--(msa\cnto);
}
\foreach \cnto in {1,2,3,4,6,7,8,9} {
    \foreach \cntt in {1} {
        \draw[-latex, draw=\colms] (msa\cnto)--(msb\cntt);
    }
}
\foreach \cntt in {1} {
    \draw[-latex, draw=\colflow] (msb\cntt)--(betams\cntt);
}
\foreach \cntt in {1} {
    \draw[-latex, draw=\colflow] (betams\cntt)--(mtb\cntt);
}
\foreach \cnto in {1} {
    % \foreach \cntt in {1,2,3,4,5,6,8,9,10,11,12,13} {
    \foreach \cntt in {8,9,10,11,12} {
        \draw[-latex, draw=\colmt] (mtb\cnto)--(msd\cntt);
    }
}
% * theta
\foreach \cj in {2,3,4,5,6} {
    \node[databetaa=\pgfmathparse{\mmmm[\cj-1]}\pgfmathresult] (theta\cj) at (-2+\msjj+\cj,\msii-12) {};
}
\foreach \cj in {8, 9,10,11,12} {
    \node[databetab=\pgfmathparse{\mmmm[\cj-1]}\pgfmathresult] (theta\cj) at (-2+\msjj+\cj,\msii-12) {};
}
% \foreach \cnto in {1,2,3,4,5,6,8,9,10,11,12,13} {
\foreach \cnto in {2,3,4,5,6,8,9,10,11,12} {
    \draw[-latex, draw=\colflow] (msd\cnto)--(theta\cnto);
}
\path (-2+\msjj+6,\msii-10) -- (-2+\msjj+8,\msii-10) node [black, font=\large, midway, sloped, draw=none] {$\dots$};
\draw [decorate,decoration={brace,amplitude=5pt,mirror,raise=4ex}](-2+\msjj+0.6+1,\msii-12+0.4) -- (-2+\msjj+13.4-1,\msii-12+0.4) node[midway,yshift=-3em,draw=none](beta){$\mathbin{\textcolor{\colbasetext}{\beta}=[\textcolor{\colbasea}{\beta_{orphaned}^{\textcolor{black}{\top}}}, \textcolor{\colbaseb}{\beta_{connected}^{\textcolor{black}{\top}}}]^{\top}}$};
% \draw[-latex, draw=\colflow] (beta.south)--(-2+\msjj+7,\ii-15)--(-2+5.4-1+0.55+2.6,\ii-15)--(-2+5.4-1+0.55+2.6,\ii-9-0.8);
\draw[-latex, draw=\colflow] (beta.west)--(5.55,-21.75+0.4)--(-2+5.4-1+0.55+2.6,\ii-9-0.8);
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](-3+0.1,-0.2-2-0.2) -- (6-0.1,-0.2-2-0.2) node[midway,yshift=+3em,draw=none](beta){81};
\draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](\msjj+0.6,-0.2-2-0.2) -- (\msjj+9.4,-0.2-2-0.2) node[midway,yshift=+3em,draw=none](beta){1000};
% \draw [decorate,decoration={brace,amplitude=5pt,raise=4ex}](\msjj+0.6,-0.2-2-0.2) -- (\msjj+9.4,-0.2-2-0.2) node[midway,yshift=+3em,draw=none](beta){1};
\end{tikzpicture}

\end{document}

